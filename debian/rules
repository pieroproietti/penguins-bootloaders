#!/usr/bin/make -f

# Abilita la modalità verbosa di Debhelper per log più chiari
export DH_VERBOSE = 1

# Questo è un target jolly di make.
# Qualsiasi target (es. clean, binary) verrà passato a Debhelper.
%:
	dh $@

# Override di dh_install per copiare i file di sistema prima dell'installazione
override_dh_install:
	# Creiamo le directory di destinazione nella cartella temporanea del pacchetto
	mkdir -p debian/tmp/usr/lib/grub/i386-pc
	mkdir -p debian/tmp/usr/lib/grub/x86_64-efi
	mkdir -p debian/tmp/usr/lib/grub/x86_64-efi-signed
	mkdir -p debian/tmp/usr/lib/shim

	# tutte le architetture
	mkdir -p debian/tmp/usr/lib/ISOLINUX
	mkdir -p debian/tmp/usr/lib/PXELINUX
	mkdir -p debian/tmp/usr/lib/syslinux/modules/bios
	mkdir -p debian/tmp/usr/lib/ipxe

	# Copia i file di sistema nelle directory temporanee

	# i386
	ifeq ($(DEB_HOST_ARCH),i386)
		# Questa riga deve iniziare con un TAB
		cp -a /usr/lib/grub/i386-pc/* debian/tmp/usr/lib/grub/i386-pc/
	endif

	# amd64
	ifeq ($(DEB_HOST_ARCH),amd64)
		# Questa riga deve iniziare con un TAB
		cp -a /usr/lib/grub/x86_64-efi/* debian/tmp/usr/lib/grub/x86_64-efi/
		cp -a /usr/lib/grub/x86_64-efi-signed/* debian/tmp/usr/lib/grub/x86_64-efi-signed/
		cp -a /usr/lib/shim/shimx64.efi.signed debian/tmp/usr/lib/shim/
	endif

	# tutte le architetture
	cp -a /usr/lib/ISOLINUX/isolinux.bin debian/tmp/usr/lib/ISOLINUX/
	cp -a /usr/lib/PXELINUX/pxelinux.0 debian/tmp/usr/lib/PXELINUX/
	cp -a /usr/lib/PXELINUX/lpxelinux.0 debian/tmp/usr/lib/PXELINUX/
	cp -a /usr/lib/syslinux/modules/bios/*.c32 debian/tmp/usr/lib/syslinux/modules/bios/
	cp -a /usr/lib/ipxe/ipxe.efi debian/tmp/usr/lib/ipxe/

	# Eseguiamo il comando dh_install originale, che ora troverà i file
	dh_install